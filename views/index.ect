<html>
    <head>
        <meta charset="utf-8">

        <link rel="stylesheet" href="/style.css">

        <script src="/js/d3.js"></script>
        <script src="/js/moment.js"></script>

        <title>Coffee Shop</title>
    </head>
    <body>
        <h1>Coffee Shop at the Wide River</h1>

        <div class="week-header">
            Week <span class="placeholder__week-number"></span>
            <span class="week-header__days placeholder__week-days"></span>
            <span class="week-header__days placeholder__week-days-count"></span>
        </div>

        <div class="columns">
            <div class="columns__column">
                <div class="counters">
                    <div class="counters__counter">
                        Guests
                        <span class="counters__counter__value placeholder__week-guests">0</span>
                    </div>
                    <div class="counters__counter">
                        Sales
                        <span class="counters__counter__value placeholder__week-sales">0</span>
                        <span class="counters__counter__note">
                            including<br/>
                            <span class="placeholder__week-sales-anonymous">0</span> anonymous
                        </span>
                    </div>
                </div>
            </div>
            <div class="columns__column">
                <div class="counters">
                    <div class="counters__counter">
                        ARPS
                        <span class="counters__counter__value">
                            <span class="placeholder__week-arps">0</span><span class="sign">₽</span>
                        </span>
                    </div>
                    <div class="counters__counter">
                        ARPG
                        <span class="counters__counter__value">
                            <span class="placeholder__week-arpg">0</span><span class="sign">₽</span>
                        </span>
                        <span class="counters__counter__note">
                            <span class="placeholder__week-arpg-div-arps">0</span><span class="sign">%</span> ARPS
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="columns">
            <div class="columns__column">
                <div class="chart chart__users-and-sales"></div>
            </div>
            <div class="columns__column">
                <div class="chart chart__arpg-and-arps"></div>
            </div>
        </div>

        <div class="columns">
            <div class="columns__column">
                <div class="counters">
                    <div class="counters__counter">
                        Penetration
                        <span class="counters__counter__value">
                            <span class="placeholder__week-penetration">0</span><span class="sign">%</span>
                        </span>
                        <span class="counters__counter__note">
                            of <span class="placeholder__week-office-population">0</span> office workers
                        </span>
                    </div>
                    <div class="counters__counter">
                        Acquisition
                        <span class="counters__counter__value">
                            <span class="placeholder__week-acquisition">0</span><span class="sign">%</span>
                        </span>
                        <span class="counters__counter__note">
                            i.e. <span class="placeholder__week-new-guests">0</span> <a href="/guests.json" target="_blank">new guests</a>
                        </span>
                    </div>
                </div>
            </div>
            <div class="columns__column">
                <div class="counters">
                    <div class="counters__counter">
                        Retention
                        <span class="counters__counter__value">
                            <span class="placeholder__week-retention">0</span><span class="sign">%</span>
                        </span>
                    </div>
                    <div class="counters__counter">
                        Churn
                        <span class="counters__counter__value">
                            <span class="placeholder__week-churn">0</span><span class="sign">%</span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="columns">
            <div class="columns__column">
                <div class="chart chart__penetration-and-acquisition"></div>
            </div>
            <div class="columns__column">
                <div class="chart chart__retention-and-churn"></div>
            </div>
        </div>

        <div class="form">
            <a href="/status.json" target="_blank">Check data status</a>
            <a href="#" class="form_upload__link">Upload a sales data file</a>

            <div class="spinner spinner_hidden form_upload__spinner">
              <div class="bounce1"></div>
              <div class="bounce2"></div>
              <div class="bounce3"></div>
            </div>

            <div class="form_upload">
                <input class="form_upload__file" type="file" name="file"/>
            </div>
        </div>

        <script src="/data.js"></script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                updateData();

                var showSpinner = function() {
                    var spinner = document.querySelector('.form_upload__spinner');
                    spinner.className = "spinner form_upload__spinner";
                };

                var hideSpinner = function() {
                    var spinner = document.querySelector('.form_upload__spinner');
                    spinner.className = "spinner spinner_hidden form_upload__spinner";
                };

                document.querySelector('.form_upload__link').onclick = function() {
                    var file = document.querySelector('.form_upload__file');
                    file.click();

                    file.onchange = function(e) {
                        var files = e.target.files || e.dataTransfer.files,
                            file = files[0];

                        if (file) {
                            var data = new FormData();
                            data.append('file', file, file.name);

                            var request = new XMLHttpRequest();
                            request.open('POST', '', true);
                            request.send(data);

                            showSpinner();

                            request.onreadystatechange = function() {
                                hideSpinner();

                                if (request.readyState == 4 && request.status == 200) {
                                    updateData();
                                }
                            };
                        }
                    };

                    return false;
                };
            });
        </script>
    </body>
</html>